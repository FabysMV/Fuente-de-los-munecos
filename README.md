<div style="border: 2px double #ff790d; padding: 10px;">
  
# Leyenda de la fuente de los muñecos
<img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/Captura%20de%20pantalla%202023-10-14%20234701.png" width="100%"
  height="100%"/>

La bella __ciudad de Puebla__, cuna de múltiples e impresionantes leyendas, alberga entre sus calles, __misterios__ que han acompañado a sus habitantes con el __pasar del tiempo__: desde la epóca prehispánica, pasando por el México colonial, llegando a los albores del siglo pasado. <br>
Los relatos que sus calles <i>susurran</i> son únicos y se viven aun en <i>tiempos modernos</i>.



## ***La fuente de los muñecos*** 
<img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/talavera.png" width="100%"
  height="100%"/>
<p align="justify">
En el que hoy es conocido como barrio de Xonaca, antaño llamado <b><i>"Barrio de los catrines"</i></b>, debido a que la gente adinerada del centro del país construía sus fincas.
Frente a la iglesia de La Candelaria, se encontraba una casona, la cual fue ocupada por la emperatriz Carlota, esposa de Maximiliano de Habsburgo. En dicha casona, Maximinio Ávila Camacho, ex-gobernador de Puebla y hermano del expresidente Manuel Ávila Camacho, construyó su casa de verano.<br> 
  <img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/avila.png" width="100%"
  height="100%"/>
<p align="justify">
Este inmueble <b>lo cuidaba un caballerango</b>, cuyo nombre se ha perdido ya entre las bocas de la gente que ha perpetuado esta historia. Dicho caballerango tenía dos hijos, <b>una niña y un niño</b>, de seis y siete años. Ambos niños eran <b><i>muy queridos y apreciados</i></b> por él y los habitantes del <i>barrio de los catrines</i>.
Un <b><i>trágico día de lluvias torrenciales</i></b>, el par de niños salió con rumbo a la escuela, desafortunadamente <b><i>nunca lograron llegar a su destino</i></b>.
Al caer la tarde, y debido a su ausencia, el padre dió la noticia y junto con los vecinos salieron en busca de los hermanos.<br>
  <p align="justify">
Con un gran pesar se dedujo que <b><i>habían caído en un pozo de agua</i></b> cercano a la propiedad del gobernador Ávila Camacho. Los cuerpos de los hermanos <b><i>nunca fueron encontrados</i></b>. Al enterarse de la noticia, el gobernador, quien estimaba mucho a su caballerango, mandó a construir una fuente, entre las que hoy son las calles 22 Oriente y 18 Norte, <b><i>con azulejos de talavera y un pedestal con la figura de dos niños</i></b>.
La pequeña niña de rostro pálido, con un libro debajo de su brazo derecho, porta un vestido con olanes, en su cabello dos largas trenzas que adornan sus hombros, extiende su brazo izquierdo con delicadeza y rodea al niño, su hermano, vestido con una camisa verde y un overol. 
<br> <br>
<img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/pozo.png" width="100%"
  height="100%"/>
<p align="justify">
Desde esa fecha e incluso ahora, los habitantes del barrio de Xonaca cuentan como <b>por las noches</b>, las figuras de los dos hermanitos <b>cobran vida</b>, salen a jugar, divertirse, sus risas llenas de júbilo resuenan por todo el barrio hasta que los primeros rayos que acompañan al amanecer aparecen. Es entonces cuando vuelven a su pedestal, para volver a quedar pretrificados, esperando a que la noche caiga una vez más y así<b> poder volver a jugar una noche más.</b></p>



  ![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/8c69c518-3ff8-407c-a290-639ac9b6fcd6)

## **Integrantes del equipo.** 

<p align="justify">
El equipo está conformado por alumnos de la carrera de Licenciatura en Ingeniería Mecatrónica de octavo y noveno semestre.</p>

| NOMBRE                         | SEMESTRE|
|--------------------------------|---------|
| Ángel López Velazco.           |    8°   | 
| Fabiola Muñoz Vera.            |    9°   | 
| Fátima Azuara Lim.             |    9°   | 
| Manuel Alejandro Vargas Castro.|    8°   | 

  
  
  <img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/tirita.png" width="100%"
  height="100%"/>
## ¿Qué hacen los muñecos?
<p align="justify">
El presente proyecto consiste en el desarrollo de dos animatrónicos, un niño y una niña, los cuales interactuarán con el público. Para esto, se utiliza un control a través de voz que detecta la intensidad con la que se les habla a los muñecos de la fuente. Éstos reaccionarán de diferente forma dependiendo de cómo se realice la comunicación con ellos.
<p align="justify">
De igual manera, la reacción de los muñecos será a través de movimiento, donde cada frecuencia de voz envía una señal diferente a los servomotores para que estos ejecuten una secuencia de movimientos predeterminados y uno de ellos dirá distintas frases dependiendo del estímulo detectado.</p>
<p align="justify">
En la siguiente tabla se explica las reacciones que tendrán los muñecos para las diferentes intensidades que sean detectadas. </p>

<img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/tabla_accion.png" width="100%"
  height="100%"/>

>Acciones de los muñecos

<p align="justify">Si nadie le habla a los muñecos, entrarán en un estado de <i>stand by</i> y harán diferentes acciones predeterminadas como cantar o mover sus cabezas.</p>  <br>  <br>
 <img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/tirita.png" width="100%"
  height="100%"/>

  
## PROCESO DE ELABORACIÓN.

**_Parte electrónica_**

<p align="justify">
En este apartado se decriben los circuitos implementados para el funcionamiento de los animatrónicos, asi como las adecuaciones tecnicas pertinentes para adecuarlo a las necesidades requeridas.</p>

<p align="justify">
En primera instancia, se ocuparon de dos circuitos de amplificación con filtrado para la voz de los animatrónicos, ya que necesitábamos que fueran lo más claro posibles y con potencia suficiente para que se escucharan a cierta distancia para lo cual nos ayudamos del OPAMP LM358 un dispositivo con el que, junto con un arreglo de capacitores (algunos de ellos se consiguieron lo más cercanos a los teóricos ya que algunos no existían comercialmente). Posterior a ello, se requirió de un circuito que controlaran los servomotores, aquí entra el famoso encapsulado CI 555, debido a su facilidad para la generación de pulsos, aplicación que utilizamos debido al tipo de señal que requieren los servomotores (PWM). Esto es de mucha importancia, ya que estos realizaran la labor del movimiento de quijada y cabeza, al mismo tiempo que estos hablan (esto junto a un arreglo de mecanismos y engranes).

</p>

![Circuito amplificador](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/4f598ded-af15-4841-99ba-1e9054e95909)

![2](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/710536d2-34ef-4c8f-bbf4-9ae741a398ac)
>Circuitos amplificadores.

![servos](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/dacdbc3f-c55e-4eed-bd40-7d0c728a11ca)
>Circuito controlador de servomotores a través de micrófono.




**_Progamación_**

El funcionamiento básico de la programación de los muñecos se describe en el siguiente diagrama. 
<img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/Mu%C3%B1ecos.png" width="100%"
  height="100%"/>

>Diagrama de flujo

Lo primero que se hace es el control de estado de los muñecos, esto se logra con dos botones que los despiertan o los ponen a dormir.
```ruby
if(digitalRead(Up) == HIGH)//si se presionó el botón, despertarán los muñecos
  {Up = true;}
 
  if(digitalRead(Sleep) == HIGH && digitalRead(Up)== LOW)//si se presionó el botón de dormir
  { delta_sec = 0;
    Up = false;
    Serial.println("dormido");
    do{ //vemos que no se haya dado la indicación de que despierten
        if(digitalRead(Up) == HIGH)
        {Up = true; Serial.println("despertando...");
        delay(100);}//si es así, cambiamos el estado de Up a activo
      }while(Up == false); //cuando Up esté activo, salimos del ciclo
    }
```
Después se revisan las primeras condiciones mostradas en la tabla anterior. 
```ruby
if(bajo<analogRead(A0)<alto) //el microfono de la nene tiene ruido?
    {//---------------------------------------------------------------------------------- 
          if(bajo<analogRead(A1)<alto) //tiene ruido la nena?
          {//// COMIENZO O SIGO EL CONTEO//////////
            if(flag == false){in = 0;}
            if(in == 0){tiempo_set = millis();}
            delta_sec = millis() - tiempo_set;
            in ++;
            if(delta_sec >= 60000){flag = true;
                                   tiempo_set = 0;}
            ////// NADA ////////////////////////////
            }//end if ruido nena
          else if(0 < analogRead(A1) < bajo) // le hablan bajo EXCLUSIVAMENTE a la nena
          { flag = false;
            nenes.g_bajo();}//end if bajo a nena
          else if(alto < analogRead(A1)< max)
          { flag = false;
            nenes.g_alto();}//end if alto a nena  
      }//end if ruido a nene-----
```

Si ninguna de las condiciones se cumplen, se revisa el segundo bloque de la tabla. 
```ruby
else if(bajo<analogRead(A1)<alto) //el microfono de la nena tiene ruido?
    {//---------------------------------------------------------------------------------- 
          if(0 < analogRead(A0) < bajo) // le hablan bajo EXCLUSIVAMENTE a nene
          { flag = false;
            nenes.b_bajo();}//end if bajo a nene
          else if(alto < analogRead(A0)< max) // le hablan alto EXCLUSIVAMENTE a nene 
          {   flag = false;
              nenes.b_alto();}//end if alto a nene
      }//end if ruido a nena----
```
Por último, si ninguno de los dos bloques coincide con el evento, se procede con el siguiente código en donde le hablan a los dos muñecos.
```ruby
///      CUANDO NO HAY RUIDO --> LE HABLAN A LOS DOS    ///
      //¿a la nena le hablan alto?
      else if(alto < analogRead(A1)< max)
      {   flag = false;
          if(alto < analogRead(A0)< max)
          {//acciones AMBOS alto
            nenes.ambos_alto();}//le hablan alto al nene?
          else if(0 < analogRead(A0) < bajo)
          {nenes.ambos_g();//le hablan más alto a la nena, el se quiere incluir
            } // le hablan bajo al nene? 
        }//end if nena alta 
        //¿a nena le hablan bajo?
      else if(0 < analogRead(A1) < bajo)
      { flag = false;
        if(alto < analogRead(A0)< max)
          { nenes.ambos_b();}//le hablan alto al nene?  
        else if(0 < analogRead(A0) < bajo)
          {nenes.ambos_bajo();} // le hablan bajo al nene?
       }//end if hablan bajo a nena
```

Si los muñecos entran en stand by, se ejecutan las acciones predeterminadas. Se cancelará esta ejecución en cuanto se vuelva a detectar un sonido en los micrófonos.

```ruby
if(flag == true)
      {
          //cálculos para el timer
          tiempo_prev = tiempo;
          tiempo = millis();
          cont_s = cont_s + tiempo - tiempo_prev; //incrementa el conteo en delta 
          if(last_s != s)
          { switch(s){case 0: nenes.baile();   break;
                      case 1: nenes.lamento(); break;
                      case 2: nenes.canto();   break;}//end switch s
            }// end if last_s

          if(cont_s >= 30000)//el límite debe de ser la duración del audio + 30 segundos
          {//ahora se cambia la secuencia
            Serial.println("cambio de secuencia");
            s = random(0,2);//elegir una secuencia 1.-baile  2.-lamento  3.-canto 
            Serial.println(s);
            cont_s = 0;}
          last_s = s;
       }//end if flag true --> que el contador ya llegó al limite
```




**_Construcción de los muñecos_**
<p align="justify">
La elaboración de cada animatrónico se basa en una estructura de CPVC, con la cual se da forma al cuerpo. De igual manera, para las uniones de las extremidades se utilizaron codos de CPVC. En general, cada muñeco cuenta con unas dimensiondes de 90cm de altura por 30cm de ancho, lo cual resulta conveniente para las dimensiones del escenario.</p>

![Diseño prelimilar muñecos](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/44503edb-7624-40fe-b8d6-a22f6f5d88d6)
>diseño preliminar de los animatrónicos.

<p align="justify">
Cada muñeco llevará una vestimenta acorde e inspirada en la leyenda, en el caso de la niña será un vestido rosa con blanco, mientras que el niño usará un overol azul con blanco.</p>

![image](https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/Dise%C3%B1o%20vestido%20ni%C3%B1a.jpeg)
>Diseño de la vestimenta de la niña.

![image](https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/Molde%20blusa%20ni%C3%B1a.jpeg)
>Molde blusa vestido de la niña.

![image](https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/Blusa%20ni%C3%B1a%20terminada.jpg)
>Blusa niña terminada.

<p align="justify">
En el caso del niño se realizó el diseño en SolidWorks de un mecanismo que le permitiera abrir y cerrar la mandibula, lo que posteriormente se llevó a imprimir 3D para montarlo en la cabeza. Cabe destacar que ambos muñecos tienen movimiento horizontal de sus cabezas.</p>

![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/72456376-9fee-4d4a-abcd-db760ba1be0f)
>Diseño de la mandíbula.

![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/ba1786ad-cba7-4a77-8d9d-469d866862e9)
>AdecuaciÓn del mecanismo de la mandíbula.

<p align="justify">
Como se puede observar en la imagen anterior se llevaron a cabo algunos ajustes para que el mecanismo cumpliera con las especificaciones de movimiento requeridas.</p>

<p align="justify">
Para el escenario, se tomó en cuenta unas dimensiones del pozo de 60cm de diámetro, la decoración de este se realizó completamente a mano para darle más detalle. En el caso de la talavera se usaron moldes para pintar estas figuras </p>

![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/8da9cf67-a834-4f49-83af-a6dc04b29c32)
>Molde de talavera.

![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/b7d150d5-848d-4a8f-a998-eabe4f967d54)
>Proceso de pintado del pozo

<p align="justify">
La construcción de las cabezas se llevó haciendo la estructura con periódico y engrudo, tal cual como si se estuviera contruyendo una piñata, esto con el objetivo de hacer el animatrónico más ligero y se le pueda dar forma a la cabeza de forma mas fácil. El cabello de ambos muñecos fue hecho de estambre y fue peinado para darle más detalle.

Finalmente, para decoración del escenario se realizaron flores de decoración para poner alrededor del escenario y así éste sea más llamativo y a la vez haga armonía con el resto de componentes del entorno y darle toques representativos y típicos de la temporada.</p>

  ![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/9c047262-ebbb-4115-897c-fb77b75055e4)
  >Trenzas de la muñeca.

  ![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/621f1a9b-2776-457d-8e0c-fd2f525328c4)
  >Guirnaldas de decoración.

![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/85769107-3184-403e-880e-166f19280159)
>Decoración de flor de cempasúchil.


 <img src="https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/tirita.png" width="100%"
  height="100%"/>
## EVIDENCIAS.

![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/e592b361-e638-42d4-ba4a-2e542bcb2edb)
>Circuito de reproducción de audio. 

![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/961bb3e5-4920-4a95-888d-2b5784c8ca0b)
>Circuito de servomotor controlado por micrófono.

![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/bd59a6ca-a73b-49d9-92c8-8ab126f9c04f)
>Diseño de mandíbula previo a impresión.
  
![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/93f09457-6ce6-49e3-8455-ece9f894928a)
>Corte de piezas del cuerpo.


![image](https://github.com/FabysMV/Fuente-de-los-munecos/assets/147775106/2d95d010-23d4-4597-893b-3fb333e7e79b)
>Ensamble de cabeza y cuerpo.

![image](https://github.com/FabysMV/Fuente-de-los-munecos/blob/main/Im%C3%A1genes/WhatsApp%20Image%202023-10-15%20at%2019.56.07.jpeg)
>Programación del control de los sensores y motores
>
<div>
